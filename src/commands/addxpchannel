module.exports = {
  name: 'addxpchannel',
  description: 'Enable XP in a specific text channel.',
  async execute(message, args, db) {
    if (!message.member.permissions.has('Administrator')) {
      return message.reply('Only admins can use this command.');
    }

    const channel = message.mentions.channels.first();
    if (!channel || channel.type !== 0) { // 0 = GuildText
      return message.reply('Please mention a valid **text** channel.');
    }

    const ref = db.collection('config').doc('xp');
    const snap = await ref.get();
    const config = snap.exists ? snap.data() : {};
    config.enabledTextChannels = config.enabledTextChannels || [];

    if (!config.enabledTextChannels.includes(channel.id)) {
      config.enabledTextChannels.push(channel.id);
      await ref.set(config, { merge: true });
      return message.reply(`✅ XP is now enabled in ${channel}.`);
    } else {
      return message.reply(`⚠️ XP was already enabled in ${channel}.`);
    }
  }
};
